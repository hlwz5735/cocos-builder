"use strict";const e=require("fs"),t=require("path"),r=require("../utils/cache"),s=require("../utils/operation");exports.template=e.readFileSync(t.join(__dirname,"../template/search.html"),"utf-8"),exports.components={node:require("./node")},exports.props=["filter"],exports.data=function(){return{nodes:r.queryNodes(),type:null,text:"",uuids:null}},exports.watch={filter(){let e=this.filter;if(/^t:.*/.test(e)){let t=e.match(/t\:([^ ]+) ?([^ ]+)?/);this.type=t?t[1]:null,this.text=t?t[2]:"",this.type&&"cc.Node"!==this.type?(Editor.Ipc.cancelRequest(this._queryID),this._queryID=Editor.Ipc.sendToPanel("scene","scene:query-nodes-by-comp-name",this.type,(e,t)=>{this.uuids=t},-1)):this.uuids=null}else if(/^used:.*/.test(e)){let t=e.match(/used\:([^ ]+) ?([^ ]+)?/),r=t?t[1]:"";Editor.Ipc.cancelRequest(this._queryID),this._queryID=Editor.Ipc.sendToPanel("scene","scene:query-nodes-by-usedby-uuid",r,(e,t)=>{this.uuids=t},-1)}else this.text=e}},exports.methods={onUpdateFilter(e,t,r){if(r&&-1===r.indexOf(e.id))return!1;if(t){let r=e.name.toLowerCase();return t=t.toLowerCase(),-1!==r.indexOf(t)}return!0},onDragStart(e){e.stopPropagation();let t=Editor.Selection.contexts("node");if(!t||t.length<=0)return e.preventDefault(),void 0;s.staging(t);let r=this.nodes.filter(e=>e.selected);Editor.UI.DragDrop.start(e.dataTransfer,{buildImage:!0,effect:"copyMove",type:"node",items:r.map(e=>({id:e.id,name:e.name}))})},onDragEnd(e){e.stopPropagation(),s.restore(),Editor.UI.DragDrop.end()}};