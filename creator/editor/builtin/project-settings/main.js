"use strict";const e=require("fire-fs"),o=require("semver"),r=require("electron");var t=0;module.exports={load(){},unload(){},messages:{open(e,o){o&&void 0!==o.tab&&(t=o.tab),Editor.Panel.open("project-settings")},close(e){Editor.Panel.close("project-settings")},"save-simulator-config"(o,r,t){if(!t)return;let s=Editor.url(r)+".json";e.existsSync(s)&&e.writeJsonSync(s,t,"utf8")},"query-tab"(e){e.reply(null,t)},"update-tab"(e,o){t=o}}},r.ipcMain.on("migrate-project",function(r,t){if(t||(t=function(){const r=require("path"),t=require("globby");let s,n=r.join(Editor.Project.path,"assets");try{let o=t.sync(`${n}/**/*.@(png|jpg).meta`,{nodir:!0,caseSensitiveMatch:!1,absolute:!0});if(!(o.length>0))return console.warn("can not guess last project version, no texture meta found"),void 0;s=e.readJsonSync(o[0])}catch(e){return console.error(e),void 0}return s&&s.ver?o.satisfies(s.ver,"< 2.3.0",{includePrerelease:!0})?(console.log("last project version must < 2.1.0 since texture meta version < 2.3.0"),"2.0.10"):(console.log("last project version must >= 2.1.0 since texture meta version >= 2.3.0"),void 0):(console.error("can not guess last project version, texture meta version is invalid"),void 0)}()),t){console.log("migrating module config from "+t);try{let r=Editor.Profile.load("profile://project/project.json"),s=r.data["excluded-modules"],n=e.readJsonSync(Editor.url("unpack://engine/modules.json")),i=!1;n.forEach(e=>{!s.includes(e.name)&&e.since&&o.satisfies(t,"< "+e.since,{includePrerelease:!0})&&(s.push(e.name),console.log(`exclude module ${e.name} because it was added since ${e.since}`),i=!0)}),i&&(r.data["excluded-modules"]=s,r.save())}catch(e){console.error(e)}}});