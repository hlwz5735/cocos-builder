"use strict";const e=require("fire-fs"),t=require("path"),s=require("lodash"),n=require("./utils");var a=t.join(Editor.remote.App.home,".download.json"),r=[];if(e.existsSync(a))try{r=e.readJSONSync(a)}catch(e){}exports.list=r;var i=s.debounce(()=>{e.writeJSONSync(a,r)},200),o={};r.forEach(s=>{var a=s.id;if(a||(a=n.md5(`${s.name}-${s.name_en}`),s.id=a,i()),o[a]=s,"download"==s.status&&(s.status="error",i()),"unzip"!=s.status&&"install"!=s.status||(s.status="finish",i()),s.status||(s.status="finish",i()),"package"===s.type&&!e.existsSync(s.file)){let n=t.join(Editor.remote.App.home,"download",s.file);e.existsSync(n)&&(s.file=n,i())}r.sort((e,t)=>t.timestamp-e.timestamp)}),exports.add=function(e){var t=n.md5(`${e.name}-${e.name_en}`),s={name:e.name||"",name_en:e.name_en||"",file:e.file||"",md5:e.md5||"",type:e.type||"other",id:t,progress:e.progress||0,status:e.status||"download",timestamp:new Date-0};return o[t]=s,r.splice(0,0,s),r.sort((e,t)=>t.timestamp-e.timestamp),i(),t},exports.remove=function(e){var t=e.id||n.md5(`${e.name}-${e.name_en}`),s=o[t];return!!s&&(delete o[t],r.some((e,s)=>e.id===t&&(r.splice(s,1),!0)),i(),JSON.parse(JSON.stringify(s)))},exports.update=function(e){var t=e.id||n.md5(`${e.name}-${e.name_en}`),s=o[t];return!!s&&(Object.keys(e).forEach(t=>{s[t]=e[t]}),i(),!0)},exports.exists=function(e){return r.some(t=>t.name===e.name&&t.name_en===e.name_en)};