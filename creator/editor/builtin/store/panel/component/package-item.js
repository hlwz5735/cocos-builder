"use struct";const e=require("../lib/utils"),t=require("../lib/network"),a=require("../lib/event"),n=require("../lib/downloader");require("electron");exports.template=e.getTemplate("package-item"),exports.components={star:require("./star")},exports.props=["language","id"],exports.data=function(){return{loading:!0,pkg:null,info:null}},exports.methods={translate:e=>Editor.T(`store.package-item.${e}`),updateData(){this.loading=!0,t.get("https://store.cocos.com/api/show_stuff",{id:this.id,user_id:Editor.remote.User.getUserId()},(e,t)=>{this.loading=!1,this.pkg=t})},_onDownload(e){e.preventDefault(),e.stopPropagation();var t=this.info,r="";"win32"==process.platform?(t.win_link,r=t.win_md5):(t.mac_link,r=t.mac_md5),Editor.remote.Metrics.trackEvent({category:"Store",action:"Download",label:t.id+""}),"33"==t.category?n.downloadPackage({name:t.title,name_en:t.title_eng,request_url:this.pkg.request_download_url,md5:r},e=>{e&&alert(e.message)}):n.downloadOther({name:t.title,name_en:t.title_eng,request_url:this.pkg.request_download_url,md5:r},e=>{e&&alert(e.message)}),a.$emit("download-changed",!0)},_onBuy(e){e.preventDefault(),e.stopPropagation(),a.$emit("pay-changed",!0),Editor.remote.User.redirect(`http://store.cocos.com/order/place_order/${this.pkg.data.id}`)},_onCannotBuy(e){e.preventDefault(),e.stopPropagation(),alert(this.translate("cannotbuy"))},_onJumpCategory(e){a.$emit("jump-category",e.id)},_getPackageName(e){if(!e)return"Unkonwn";var t="";return"en"==this.language&&(t=e.title_eng),t||(t=e.title),t},_getPackageVersion:e=>e?e.tools_version:"0.0.0",_getPackageCategory(e){if(!e)return"Unkonwn";var t="";return"en"==this.language&&(t=e.name_en),t||(t=e.name),t},_getPackageUser:e=>e?e.username:"Unknown",_getPackageDemand:e=>e?e.version:"Unkonwn",_getPackageIcon:t=>t?e.completionURL(t.icon,{protocol:"http",host:"imgcdn.store.cocos.com",attach:""}):"",_getPackageContent(e){return e?("en"==this.language&&(t=e.content_eng),t||(t=e.content),t.replace(/\n/g,"<br/>")):"";var t},_getPackagePrice(e){var t,a="zh"==this.language?"ï¿¥":"$";return e?("zh"==this.language&&(t=e.price_cn),t||(t=e.price_eng),`${a}${t}`):`${a}0`}},exports.watch={id(){this.updateData()},pkg(e){this.info=e.data;var t=this._getPackageContent(e.data);t&&(t=t.replace(/\<br ?\/\>/g,"\n\n")),this.$els.view.value=t}},exports.ready=function(){this.updateData(),a.$on("refresh-data",()=>{this.updateData()})};