"use struct";const t=require("electron"),e=require("url"),a=require("../lib/utils"),n=require("../lib/network"),r=require("../lib/event");exports.template=a.getTemplate("package-home"),exports.props=["language"],exports.data=function(){return{loading:!0,id:-1,type:"free",data:null,list:null,banners:null,currentBanner:-1}},exports.methods={translate:t=>Editor.T(`store.package-list.${t}`),updateData(){this.id;this.loading=!0,n.get("https://store.cocos.com/api/all_pay_and_free_rank",{lang:this.language},(t,e)=>{this.loading=!1,this.data=t?null:e})},updateList(){return this.data?("free"==this.type?t=this.data.free_rank:"pay"==this.type&&(t=this.data.pay_rank),t?(this.list=t.data,void 0):this.list=null):this.list=null;var t},updateBanner(){n.get("https://store.cocos.com/api/all_client_slide",{},(t,e)=>{e=e||[],this.banners=e.filter(t=>"2"==t.locate),this.currentBanner=0,this.bannerStep()})},bannerStep(){clearTimeout(this.bannerTimer),this.bannerTimer=setTimeout(()=>{this.currentBanner+1>=this.banners.length?this.currentBanner=0:this.currentBanner++,this.bannerStep()},5e3)},_onBannerChanged(t){this.bannerStep(),this.currentBanner=t},_onJumpBanner(a){var n=e.parse(a),s=n.pathname.match(/\/stuff\/show\/(\d{6})\.html/);"store.cocos.com"==n.host&&s&&s[1]?r.$emit("jump-package",s[1]):t.shell.openExternal(a)},_onOpenDevelop(){t.shell.openExternal("https://open.cocos.com/app")},_getUrl:t=>a.completionURL(t,{protocol:"http",host:"imgcdn.store.cocos.com",attach:"!75x75"}),_getBannerImg:t=>a.completionURL(t,{protocol:"http",host:"imgcdn.store.cocos.com"}),_onTypeChanged(t){this.type=t},_onJumpPackage(t){r.$emit("jump-package",t.id)},_getPackageName(t){var e="";return"en"==this.language&&(e=t.title_eng),e||(e=t.title),e},_getCategory(t){var e="";return"en"==this.language&&(e=t.name_en),e||(e=t.name),e}},exports.watch={id(){this.updateData()},data(){this.updateList()},type(){this.updateList()}},exports.ready=function(){this.updateData(),this.bannerTimer=null,this.updateBanner(),r.$on("refresh-data",()=>{this.updateData()})};