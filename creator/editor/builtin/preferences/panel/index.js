"use strict";const e=require("fire-fs"),t=(require("fire-path"),Editor.require("packages://preferences/panel/utils"));Editor.Panel.extend({style:e.readFileSync(Editor.url("packages://preferences/panel/style/home.css")),template:e.readFileSync(Editor.url("packages://preferences/panel/template/home.html")),ready(){t.init().then(()=>new Promise((e,t)=>{Editor.Ipc.sendToMain("preferences:query-tab",function(t,r){e(t?0:r)})})).then(e=>{let r=function(e,r){return new Vue({el:e,data:{loaded:!0,changed:!1,tab:r||0,loading:!1,general:t.queryGeneral(),editor:t.queryEditor(),native:t.queryNative(),preview:t.queryPreview()},watch:{tab(e){Editor.Ipc.sendToMain("preferences:update-tab",e)},general:{deep:!0,handler(){this.changed=!0}},editor:{deep:!0,handler(){this.changed=!0}},native:{deep:!0,handler(){this.changed=!0}},preview:{deep:!0,handler(){this.changed=!0}},"native.useDefaultCppEngine"(e){let r=e?null:this.native.cppEnginePath;t.resetSimulatorConfig(r),this.preview=t.queryPreview()},"native.cppEnginePath"(e){e=this.native.useDefaultCppEngine?null:e,t.resetSimulatorConfig(e),this.preview=t.queryPreview()}},methods:{T:Editor.T,_selectTab(e){this.tab=e,Editor.Ipc.sendToMain("preferences:update-tab",e)},_save(){this.loading=!0,this.changed=!1,setTimeout(()=>{t.setGeneral(this.general),t.setEditor(this.editor),t.setNative(this.native),t.setPreview(this.preview),t.save(),setTimeout(()=>{this.loading=!1},300)},200)}},components:{general:Editor.require("packages://preferences/panel/components/general"),editor:Editor.require("packages://preferences/panel/components/editor"),native:Editor.require("packages://preferences/panel/components/native"),preview:Editor.require("packages://preferences/panel/components/preview")}})}(this.shadowRoot.getElementById("settings"),e);window.addEventListener("beforeunload",t=>{r.changed&&(t.returnValue=!0,process.nextTick(()=>{switch(Editor.Dialog.messageBox({type:"info",buttons:[Editor.T("MESSAGE.save"),Editor.T("MESSAGE.dont_save"),Editor.T("MESSAGE.cancel")],title:Editor.T("MESSAGE.warning"),message:Editor.T("MESSAGE.warning"),detail:Editor.T("MESSAGE.preferences.modified"),defaultId:0,cancelId:0,noLink:!0})){case 0:r._save();case 1:r.changed=!1,Editor.Ipc.sendToMain("preferences:close",e)}}))})})}});