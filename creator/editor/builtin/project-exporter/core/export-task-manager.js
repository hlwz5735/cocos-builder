const s=require("fire-path");class t{constructor(s,t,e,i){this.src=s,this.dest=t,this.uuid=e,this.isRaw=i}}var e=/_([^_]*)$/;function i(t){var i=!1,r=s.parse(t);return r.name=r.name.replace(e,function(s,t){var e=Number.parseInt(t,10);return!isNaN(e)&&e>=0?(i=!0,"_"+(e+1)):"_"===s?(i=!0,"_2"):s}),i||(r.name+="_2"),r.base=void 0,s.format(r)}module.exports=class{constructor(){this.uuidToTask={},this.destToTask={}}_resolveConflict(s){do{s=i(s)}while(s in this.destToTask);return s}add(s,e,i,r){var o=this.destToTask[e];if(o)if(i){if(o.isRaw){var a=`can not export ${r} because ${o.uuid} already exists in ${e}`;return Editor.error(a)}delete this.destToTask[e],o.dest=this._resolveConflict(e),this.destToTask[o.dest]=o,console.log(`${o.uuid}'s dest conflict with ${r}: ${e}, auto rename to ${o.dest}`)}else e=this._resolveConflict(e),console.log(`${r}'s dest conflict with ${o.uuid}: ${o.dest}, auto renam to ${e}`);var d=new t(s,e,r,i);if(this.destToTask[e]=d,r){if(r in this.uuidToTask)return Editor.error(`uuid already exists: ${r}`);this.uuidToTask[r]=d}}};