"use strict";const e=require("electron"),t=e.ipcMain,i=require("child_process").spawn,o=require("path"),n=require("fire-fs"),r=require("plist");t.on("assets:open-text-file",function(t,i){if("default"===Editor.Profile.load("profile://global/settings.json").data["script-editor"]){if(Editor.isWin32){return 1===Editor.Dialog.messageBox({type:"warning",buttons:[Editor.T("MESSAGE.cancel"),Editor.T("MESSAGE.yes")],title:Editor.T("MESSAGE.warning"),message:Editor.T("MESSAGE.warning"),detail:Editor.T("PREFERENCES.vacancy_script_editor_tips")})&&(Editor.Ipc.sendToMain("preferences:update-tab",1),Editor.Ipc.sendToPanel("preferences","update-tab",1),Editor.Panel.open("preferences")),void 0}let t=Editor.assetdb.uuidToFspath(i);e.shell.openItem(t)}else{let e=Editor.assetdb.uuidToFspath(i);e&&Editor.Ipc.sendToMain("assets:open-text-file-by-path",e)}}),t.on("assets:open-text-file-by-path",function(e,t){let s=Editor.Profile.load("profile://global/settings.json").data["script-editor"];if("default"==s)return Editor.warn("Can not open "+t+" because text editor is not configured.");let a=[],d="";if("darwin"===process.platform){if(s.endsWith(".app")){s=o.join(s,"/Contents/MacOS/");let e=r.parse(n.readFileSync(o.join(s,"../Info.plist"),"utf8"));s=o.join(s,e.CFBundleExecutable)}-1!==s.indexOf("Visual Studio Code")?(d=s,a=[Editor.Project.path,t,"-n"]):(d="open",a=["-a",o.basename(s),t])}else-1!==s.indexOf("Code")?(d=s,a=[Editor.Project.path,t,"-r"]):(d=s,a=[t]);i(d,a,{detached:!0,stdio:"ignore"}).unref()}),t.on("assets:open-texture-file",function(e,t){let i=Editor.assetdb.uuidToFspath(t);i&&Editor.Ipc.sendToMain("assets:open-texture-file-by-path",i)}),t.on("assets:open-texture-file-by-path",function(e,t){let s=Editor.Profile.load("profile://global/settings.json").data["picture-editor-root"];if(s){let e=[],a="";if("darwin"===process.platform){if(s.endsWith(".app")){s=o.join(s,"/Contents/MacOS/");let e=r.parse(n.readFileSync(o.join(s,"../Info.plist"),"utf8"));s=o.join(s,e.CFBundleExecutable)}a="open",e=["-a",s,t]}else a=s,e=[t];i(a,e,{detached:!0,stdio:"ignore"}).unref()}});