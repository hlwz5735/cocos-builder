"use strict";const e=require("../libs/dump"),{promisify:i}=require("util"),t=require("../libs/advice"),a=require("../libs/manager");let n=!1;module.exports={ready(){this.vm.init()},reloading(){this.vm.init()},"animation-clips-changed"(){this.vm.updateClips()},async"animation-clip-changed"(e,t){let n=await i(cc.AssetLibrary.loadJson)(t.data);n._uuid=t.uuid,a.unregister(n),a.register(n)},"animation-state-changed"(e,i){if("play"===i.state){this.vm.paused=!1,(async(e,i,a)=>{if(n)return;n=!0;let s=()=>{Editor.Ipc.sendToPanel("scene","scene:query-animation-time",{rootId:e,clip:i},(e,i)=>{let r=Math.round(i*a);t.emit("change-frame",r),n&&requestAnimationFrame(s)})};requestAnimationFrame(s)})(this.vm.hierarchy[0].id,this.vm.clip.name,this.vm.sample)}else this.vm.paused=!0,n=!1},async"animation-record-changed"(e,n){if(n){this.vm.record=!0;this.vm.hierarchy[0].id;let e=this.vm.clip.name;Editor.Ipc.sendToPanel("scene","scene:change-animation-current-clip",e)}else{this.vm.record=!1;let e=this.vm.clip?this.vm.clip.id:"";if(!e)return;let n=await i(cc.AssetLibrary.loadAsset)(e);a.unregister(n),a.register(n),t.emit("clip-data-update"),t.emit("change-event",-1),t.emit("change-eline",null),this.vm.init()}},"node-component-added"(i,t){t.node===e.root&&"cc.Animation"===t.component&&e.update(()=>{this.vm.updateState()})},"node-component-removed"(i,t){t.node===e.root&&e.update(()=>{this.vm.updateState()})},async"node-component-updated"(i,t){t.node&&t.node===e.root&&await this.vm.updateClips()}};