"use strict";let t=require("./controller-base"),e=require("../utils/controller-utils");const{create3DNode:i,setMeshColor:r}=require("../../../utils/engine"),o=require("../../../utils/external").EditorCamera;let l=cc.v3();module.exports=class extends t{constructor(t){super(t),this._editable=!1,this._edit=!1,this._editControllerShape=null,this._defaultEditCtrlSize=5,this._hoverColor=cc.Color.GREEN,this._editCtrlScales={},o._camera.node.on("transform-changed",this.onEditorCameraMoved,this)}get editable(){return this._editable}set editable(t){this._editable=t}get edit(){return this._edit}set edit(t){this._editable&&(this._edit=t,!0===this._edit?(this.initEditController(),this._editControllerShape.active=!0):this.hideEditController())}get hoverColor(){return this._hoverColor}set hoverColor(t){this._hoverColor=t}createEditControllerShape(){this._editControllerShape=i("EditControllerShape"),this._editControllerShape.parent=this.shape}setEditCtrlColor(t){this.editable&&this.edit&&Object.keys(this._axisDir).forEach(e=>{let i=this._axisDataMap[e];if(i){let e=i.topNode;r(e,t)}})}hideEditController(){this._editControllerShape&&(this._editControllerShape.active=!1)}createEditController(t,i){let r=this._defaultEditCtrlSize,o=e.quad(r,r,i,{unlit:!0});o.name=t,o.parent=this._editControllerShape,this._editCtrlScales[t]=cc.v3(1,1,1),this.initAxis(o,t),this._updateEditController(t)}initEditController(){this._editControllerShape||(this.createEditControllerShape(),Object.keys(this._axisDir).forEach(t=>{this.createEditController(t,this._color)}))}_updateEditController(t){}updateEditControllers(){Object.keys(this._axisDir).forEach(t=>{this._updateEditController(t)})}checkEdit(){this.editable?this.edit=!0:this.hideEditController()}onHoverIn(t){this.setAxisColor(t.axisName,this.hoverColor)}onHoverOut(){this.resetAxisColor()}onEditorCameraMoved(){this.adjustEditControllerSize()}adjustEditControllerSize(){this.edit&&Object.keys(this._axisDir).forEach(t=>{let e=this._axisDataMap[t];if(e){let t=e.topNode;t.getWorldPosition(l);let i=this.getCameraDistScalar(l);this._editCtrlScales[this._axisDir]=i,t.setScale(cc.v3(i/this._scale.x,i/this._scale.y,i/this._scale.z));let r=cc.quat();o._camera.node.getWorldRotation(r),t.setWorldRotation(r)}})}};