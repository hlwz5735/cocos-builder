"use strict";var t=["_parent","_children","parent","children","rotationX","rotationY","rotation"],e=cc.Class.Attr.DELIMETER+"hasGetter",n=cc.Class.Attr.DELIMETER+"hasSetter",o=cc.Class.Attr.DELIMETER+"serializable";function r(t){return t instanceof cc.ValueType?t.clone():t}function c(t,e,n,o){n=n||r;let c={};if(o)for(let r=0;r<e.length;r++){let s=e[r];o(s)&&(c[s]=n(t[s]))}else for(let o=0;o<e.length;o++){let r=e[o];c[r]=n(t[r])}return c}function s(t){return t&&"object"==typeof t?Array.isArray(t)?t.map(r):t.constructor===Object?c(t,Object.getOwnPropertyNames(t)):r(t):t}function a(r){if(!r||"object"!=typeof r)return Editor.error("Unknown object to record"),void 0;if(Array.isArray(r))return r.map(s);var a=r.constructor;if(a===Object)return c(r,Object.getOwnPropertyNames(r),s);if(cc.Class._isCCClass(a)){var i=a.__props__,f=cc.Class.Attr.getClassAttrs(a),u=c(r,i,s,function(c){var s=f[c+e];return!(!s&&!1===f[c+o])&&(s===f[c+n]&&((!r.hasOwnProperty(c)||"function"!==r[c])&&(!cc.Node.isNode(r)||!t.includes(c))))});return r.__asyncStates&&(u.__asyncStates=JSON.parse(JSON.stringify(r.__asyncStates))),u}Editor.error("Unknown object to record")}function i(t,e){return e&&t&&"object"==typeof e?e.constructor!==t.constructor?e:Array.isArray(e)?(f(t,e),t):t.constructor===Object?(u(t,e),t):r(e):e}function f(t,e,n){var o,c=t.length=e.length;if(n)for(o=0;o<c;o++)t[o]=n(t[o],e[o]);else for(o=0;o<c;o++)t[o]=r(e[o])}function u(t,e,n){var o;for(o in t)o in e||delete t[o];if(n)for(o in e)t[o]=n(t[o],e[o]);else for(o in e)t[o]=r(e[o])}function l(t,e){var n,o,r;t instanceof cc.Object&&(cc.Object._willDestroy(t)&&(!cc.isValid(e)||cc.Object._willDestroy(e)||cc.Object._cancelDestroy(t)));if(!("function"==typeof t.onRestore))for(r in e)if((n=cc.js.getPropertyDescriptor(t,r))&&n.set){o=i(t[r],e[r]);var c=t[r];if(o!==c){if(o instanceof cc.ValueType){if(o.equals(c))continue}else if(c instanceof cc.ValueType&&c.equals(o))continue;t[r]=o}}for(r in e){if((n=Object.getOwnPropertyDescriptor(t,r))&&"value"in n)n.writable&&(t[r]=i(t[r],e[r]))}(function(t,e){var n=e.__asyncStates;if(n)for(var o in n){var r=n[o];"start"===r.state&&Editor.setAsset(t,o,r.uuid)}})(t,e)}function d(t,e){p(t,e),b(t)}function p(t,e){if(!t||"object"!=typeof t)return Editor.error("Unknown object to restore");if(!e)return Editor.error("Invalid record to restore");if(Array.isArray(t))f(t,e,i);else{var n=t.constructor;n===Object?u(t,e,i):cc.Class._isCCClass(n)?l(t,e):Editor.error("Unknown object to restore")}}function b(t){var e=t.constructor;cc.Class._isCCClass(e)&&"function"==typeof t.onRestore&&t.onRestore()}function y(t){t._objFlags&=cc.Object.Flags.PersistentMask,t._objFlags&=~cc.Object.Flags.Destroyed,t instanceof cc.Component&&(cc.engine.attachedObjsForEditor[t.uuid]=t)}module.exports={recordObject:a,restoreObject:d,renewObject:y,recordNode:function(t){for(var e={},n=0;n<t._components.length;++n){var o=t._components[n];e[o.uuid]=a(o)}return{node:a(t),comps:e}},restoreNode:function(t,e){for(let t in e.comps){let n=cc.engine.getInstanceById(t);n&&p(n,e.comps[t])}p(t,e.node);for(let t in e.comps){let e=cc.engine.getInstanceById(t);e&&b(e)}b(t)},recordDeleteNode:function(t){var e=[];_Scene.walk(t,!1,function(t){e.push({node:t,data:function(t){for(var e=[],n=0;n<t._components.length;++n){var o=t._components[n];e.push({comp:o,data:a(o)})}return{nodeData:a(t),compInfos:e}}(t)})});for(var n=[],o=0;o<t._components.length;++o){var r=t._components[o];n.push({comp:r,data:a(r)})}return{parent:t.parent,siblingIndex:t.getSiblingIndex(),nodeData:a(t),compInfos:n,childInfos:e}},restoreDeleteNode:function(t,e){e.compInfos.forEach(function(t){d(t.comp,t.data),y(t.comp)}),e.childInfos.forEach(function(t){(function(t,e){d(t,e.nodeData),y(t),e.compInfos.forEach(function(t){d(t.comp,t.data),y(t.comp)})})(t.node,t.data)}),d(t,e.nodeData),y(t),t.parent=e.parent,t.setSiblingIndex(e.siblingIndex)}};