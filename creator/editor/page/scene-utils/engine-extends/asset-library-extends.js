"use strict";var e=require("electron"),n=require("fire-path"),s=e.ipcRenderer,t=Editor.require("unpack://engine-dev/cocos2d/core/platform/callbacks-invoker"),o=cc.AssetLibrary;function c(e){cc.loader.release(e)}s.on("asset-db:assets-moved",function(e,n){n.forEach(function(e){o.onAssetMoved(e.uuid,e.srcPath,e.destPath)})}),s.on("asset-db:asset-changed",function(e,n){o.onAssetChanged(n.uuid)}),s.on("asset-db:assets-deleted",function(e,n){n.forEach(function(e){o.onAssetRemoved(e.uuid,e.path)})});var i=o.assetListener=new t;o.onAssetMoved=function(e,s,t){var r=n.basenameNoExt(s),a=n.basenameNoExt(t);cc.loader.refreshUrl(e,s,t),i.hasEventListener(e)&&o._queryAssetInfoInEditor(e,function(n,s,r,a){if(!n)if(r)i.invoke(e,t);else{if(c(s),cc.js.isChildClassOf(a,cc.Scene))return;o.loadAsset(e,function(n,s){i.emit?i.emit(e,s):i.invoke(e,s)})}}),"undefined"!=typeof _Scene&&o._queryAssetInfoInEditor(e,function(n,s,t,o){n||cc.js.isChildClassOf(o,cc.Prefab)&&_Scene.walk(cc.director.getScene(),!1,n=>{var s=n._prefab;if(s){if(s.asset&&s.asset._uuid===e)n.name!==r||(n.name=a);return!0}})})},o.onAssetChanged=function(e){o._queryAssetInfoInEditor(e,function(n,s,t,r){if(!n){if(cc.loader.getRes(s))return cc.loader.release(s),cc.loader.load(s,function(n,t){t&&i.hasEventListener(e)&&i.invoke(e,s)}),void 0;i.hasEventListener(e)&&(c(s),cc.js.isChildClassOf(r,cc.Scene)||(t?i.invoke(e,s):o.loadAsset(e,function(n,s){i.invoke(e,s)})))}})},o.onAssetRemoved=function(e,n){c(n),console.log("delete cache of "+n),i.invoke(e,null)};