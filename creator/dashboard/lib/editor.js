"use strict";const{app:e,dialog:o,BrowserWindow:r}=require("electron"),{spawn:t}=require("child_process"),{join:n}=require("path");let s=[],i=e.getPath("exe");exports.startup=function(r,d,l){let a=n(r,"local/logs/project.log"),p=[Editor.App.path,"--path",r,"--logfile",a];d||p.push("--nologin"),l&&p.push("--dev"),Editor.showInternalMount&&p.push("--internal");let c=t(i,p,{stdio:[0,1,2,"ipc"],env:process.env});process.env.checkedVersion=!1;let h=[],u=!1,f=function(){if(u)return;u=!0;let e=h.shift();if(1!==o.showMessageBox({type:"error",buttons:["OK","Abort"],title:"Error",message:e.message,detail:e.stack,defaultId:0,cancelId:0}))return h.length>0&&f(),u=!1,void 0;setTimeout(()=>{h.length=0,c.kill(),u=!1},200)};return c.on("message",e=>{"show-dashboard"===e.channel?(Editor.App._profile.reload(),Editor.Ipc.sendToMainWin("dashboard:refresh-recent-project"),Editor.Ipc.sendToMainWin("dashboard:refresh-last-create"),Editor.Window.main.show()):"editor-error"===e.channel&&(h.push(e),f())}),c.on("close",()=>{let o=s.indexOf(c);-1!==o&&s.splice(o,1),0===s.length&&(Editor.App._profile.reload(),Editor.Ipc.sendToMainWin("dashboard:refresh-recent-project"),Editor.Ipc.sendToMainWin("dashboard:refresh-last-create"),Editor.Window.main.show(),e.dock&&e.dock.show())}),s.push(c),e.dock&&e.dock.hide(),c},exports.closeAll=function(){for(;s.length>0;)s.pop().kill()},exports.isEmpty=function(){return s.length<=0};